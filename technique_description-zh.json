[
  {
    "id": "T1608",
    "name": "Stage Capabilities",
    "tactics": [
      {
        "id": "TA0042",
        "name": "Resource Development"
      }
    ],
    "subs": [
      {
        "id": "T1608.001",
        "name": "Upload Malware"
      },
      {
        "id": "T1608.002",
        "name": "Upload Tool"
      },
      {
        "id": "T1608.003",
        "name": "Install Digital Certificate"
      },
      {
        "id": "T1608.004",
        "name": "Drive-by Target"
      },
      {
        "id": "T1608.005",
        "name": "Link Target"
      },
      {
        "id": "T1608.006",
        "name": "SEO Poisoning"
      }
    ],
    "version": "1.2",
    "description": [
      [
        {
          "type": "text",
          "content": "敌人可以上传、安装或以其他方式设置可在瞄准过程中使用的功能。为了支持他们的行动，对手可能需要获得他们开发的（发展能力）或获得的（获得能力）能力，并将其部署在他们控制的基础设施上。这些能力可以在对手之前购买/租用的基础设施上进行部署（获取基础设施），或者在其他方面受到对手的损害（损害基础设施）。功能也可以在web服务上部署，如GitHub或Pastebin，或在平台即服务（PaaS）产品上部署，使用户可以轻松地配置应用程序。"
        }
      ],
      [
        {
          "type": "text",
          "content": "能力的分级可以帮助对手进行一些初始访问和妥协后的行为，包括（但不限于）："
        }
      ],
      [
        {
          "type": "list",
          "content": "当用户浏览到某个网站时，暂存执行“按妥协驱动”所需的web资源。"
        },
        {
          "type": "list",
          "content": "正在暂存链接目标的web资源，以便与鱼叉式网络钓鱼一起使用。"
        },
        {
          "type": "list",
          "content": "将恶意软件或工具上传到受害者网络可访问的位置，以启用Ingress Tool Transfer。"
        },
        {
          "type": "list",
          "content": "安装以前获取的SSL/TLS证书以用于加密命令和控制流量（例如：使用Web协议的不对称加密）。"
        }
      ]
    ],
    "mitigations": [
      {
        "id": "M1056",
        "name": "妥协前",
        "description": [
          [
            {
              "type": "text",
              "content": "这种技术无法通过预防性控制轻易缓解，因为它是基于在企业防御和控制范围之外执行的行为。"
            }
          ]
        ]
      }
    ]
  },
  {
    "id": "T1558",
    "name": "Steal or Forge Kerberos Tickets",
    "tactics": [
      {
        "id": "TA0006",
        "name": "Credential Access"
      }
    ],
    "subs": [
      {
        "id": "T1558.001",
        "name": "Golden Ticket"
      },
      {
        "id": "T1558.002",
        "name": "Silver Ticket"
      },
      {
        "id": "T1558.003",
        "name": "Kerberoasting"
      },
      {
        "id": "T1558.004",
        "name": "AS-REP Roasting"
      }
    ],
    "version": "1.4",
    "description": [
      [
        {
          "type": "text",
          "content": "对手可能试图通过窃取或伪造Kerberos票证来破坏Kerberos身份验证，从而启用“通过票证”。Kerberos是一种在现代Windows域环境中广泛使用的身份验证协议。在Kerberos环境（称为“领域”）中，有三个基本参与者：客户端、服务和密钥分发中心（KDC）。客户端请求访问服务，并通过交换源自KDC的Kerberos票证，在成功进行身份验证后授予访问权限。KDC负责身份验证和票证授予。对手可能试图通过窃取票证或伪造票证来滥用Kerberos，以实现未经授权的访问。"
        }
      ],
      [
        {
          "type": "text",
          "content": "在Windows上，内置的"
        },
        {
          "type": "code",
          "content": "klist"
        },
        {
          "type": "text",
          "content": "实用程序可用于列出和分析缓存的Kerberos票证。"
        }
      ],
      [
        {
          "type": "text",
          "content": "Active Directory域上的Linux系统将Kerberos凭据本地存储在称为“ccache”的凭据缓存文件中。凭据存储在ccache文件中，同时它们保持有效，通常在用户会话持续期间。在现代Redhat Enterprise Linux系统和衍生发行版上，系统安全服务守护程序（SSSD）处理Kerberos票证。默认情况下，SSSD维护可在"
        },
        {
          "type": "code",
          "content": "/var/lib/sss/ssecrets/secrets.ldb"
        },
        {
          "type": "text",
          "content": "中找到的票证数据库的副本，以及位于"
        },
        {
          "type": "code",
          "content": "/var/lib/sss/ssecrets/.ssecrets.mkey"
        },
        {
          "type": "text",
          "content": "的相应密钥。这两个文件都需要root访问权限才能读取。如果对手能够访问数据库和密钥，则可以提取凭证缓存Kerberos blob，并将其转换为可用的Kerberos ccache文件，对手可以使用该文件来传递票证。ccache文件也可以使用Kekeo等工具转换为Windows格式。"
        }
      ],
      [
        {
          "type": "text",
          "content": "macOS上的Kerberos票证以类似于Linux的标准ccache格式存储。默认情况下，对这些ccache条目的访问是通过马赫RPC协议通过KCM守护进程进行联合的，该协议使用调用方的环境来确定访问。这些ccache条目的存储位置受"
        },
        {
          "type": "code",
          "content": "/etc/krb5.conf"
        },
        {
          "type": "text",
          "content": "配置文件和"
        },
        {
          "type": "code",
          "content": "KRB5CCNAME"
        },
        {
          "type": "text",
          "content": "环境变量的影响，后者可以指定将它们保存到磁盘或通过KCM守护进程保护它们。用户可以使用"
        },
        {
          "type": "code",
          "content": "kinit"
        },
        {
          "type": "text",
          "content": "、"
        },
        {
          "type": "code",
          "content": "klist"
        },
        {
          "type": "text",
          "content": "，"
        },
        {
          "type": "code",
          "content": "ktutil"
        },
        {
          "type": "text",
          "content": "和"
        },
        {
          "type": "code",
          "content": "kcc"
        },
        {
          "type": "text",
          "content": "内置二进制文件或通过苹果的本地Kerberos框架与票证存储交互。对手可以使用开源工具直接与ccache文件交互，也可以使用Kerberos框架调用较低级别的API来提取用户的TGT或服务票证。"
        }
      ]
    ],
    "mitigations": [
      {
        "id": "M1015",
        "name": "Active Directory配置",
        "description": [
          [
            {
              "type": "text",
              "content": "为了包含以前生成的黄金票证的影响，请重置内置的KRBTGT帐户密码两次，这将使使用KRBTGT哈希创建的任何现有黄金票证和从中派生的其他Kerberos票证无效。对于每个域，请更改一次KRBTGT帐户密码，强制复制，然后第二次更改密码。考虑每180天轮换一次KRBTGT帐户密码。"
            }
          ]
        ]
      },
      {
        "id": "M1041",
        "name": "加密敏感信息",
        "description": [
          [
            {
              "type": "text",
              "content": "尽可能启用AES Kerberos加密（或其他更强的加密算法），而不是RC4。"
            }
          ]
        ]
      },
      {
        "id": "M1027",
        "name": "密码策略",
        "description": [
          [
            {
              "type": "text",
              "content": "确保服务帐户的密码长度（最好超过25个字符）和复杂性很强，并且这些密码会定期过期。还可以考虑使用集团托管服务帐户或其他第三方产品，如密码保险存储。"
            }
          ]
        ]
      },
      {
        "id": "M1026",
        "name": "特权帐户管理",
        "description": [
          [
            {
              "type": "text",
              "content": "将域管理员帐户权限限制为域控制器和有限的服务器。将其他管理功能委托给单独的帐户。"
            }
          ],
          [
            {
              "type": "text",
              "content": "将服务帐户限制为所需的最低权限，包括域管理员等特权组的成员资格。"
            }
          ]
        ]
      }
    ]
  },
  {
    "id": "T1556",
    "name": "Modify Authentication Process",
    "tactics": [
      {
        "id": "TA0006",
        "name": "Credential Access"
      },
      {
        "id": "TA0005",
        "name": "Defense Evasion"
      },
      {
        "id": "TA0003",
        "name": "Persistence"
      }
    ],
    "subs": [
      {
        "id": "T1556.001",
        "name": "Domain Controller Authentication"
      },
      {
        "id": "T1556.002",
        "name": "Password Filter DLL"
      },
      {
        "id": "T1556.003",
        "name": "Pluggable Authentication Modules"
      },
      {
        "id": "T1556.004",
        "name": "Network Device Authentication"
      },
      {
        "id": "T1556.005",
        "name": "Reversible Encryption"
      },
      {
        "id": "T1556.006",
        "name": "Multi-Factor Authentication"
      },
      {
        "id": "T1556.007",
        "name": "Hybrid Identity"
      },
      {
        "id": "T1556.008",
        "name": "Network Provider DLL"
      }
    ],
    "version": "2.3",
    "description": [
      [
        {
          "type": "text",
          "content": "对手可能会修改身份验证机制和过程以访问用户凭据，或以其他方式对帐户进行不必要的访问。身份验证过程由一些机制处理，如Windows上的本地安全身份验证服务器（LSASS）过程和安全帐户管理器（SAM），基于Unix的系统上的可插入身份验证模块（PAM），以及MacOS系统上负责收集、存储和验证凭据的授权插件。通过修改身份验证过程，对手可以在不使用有效帐户的情况下对服务或系统进行身份验证。"
        }
      ],
      [
        {
          "type": "text",
          "content": "对手可能会恶意修改此过程的一部分，以显示凭据或绕过身份验证机制。泄露的凭证或访问可用于绕过网络内系统上各种资源上的访问控制，甚至可用于持久访问远程系统和外部可用服务，如VPN、Outlook Web access和远程桌面。"
        }
      ]
    ],
    "mitigations": [
      {
        "id": "M1047",
        "name": "审计",
        "description": [
          [
            {
              "type": "text",
              "content": "审查身份验证日志，以确保MFA强制执行等机制按预期运行。"
            }
          ],
          [
            {
              "type": "text",
              "content": "定期检查正在使用的混合身份解决方案是否存在任何差异。例如，查看Azure管理门户中的所有直通身份验证（PTA）代理，以识别任何不需要或未批准的代理。如果正在使用ADFS，请检查AD FS和全局程序集缓存目录中的DLL和可执行文件，以确保它们由Microsoft签名。请注意，在某些情况下，二进制文件可能是经过目录签名的，这可能会导致在查看文件属性时文件显示为未签名。"
            }
          ],
          [
            {
              "type": "text",
              "content": "定期检查注册表中新的和未知的网络提供程序DLL（"
            },
            {
              "type": "code",
              "content": "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\<NetworkProviderName>\\NetworkProvider\\ProviderPath"
            },
            {
              "type": "text",
              "content": "）。请确保仅注册了有效的网络提供程序DLL。这些服务的名称可以在注册表项的"
            },
            {
              "type": "code",
              "content": "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order中找到，并且相应的服务子项指向HKEY_LOCAL_MACHINE\\SSYSTEM\\CurrentC ontrolSet\\Services\\<NetworkProviderName>\\NetworkProvider"
            },
            {
              "type": "text",
              "content": "中的DLL。"
            }
          ]
        ]
      },
      {
        "id": "M1032",
        "name": "多因素身份验证",
        "description": [
          [
            {
              "type": "text",
              "content": "将多因素身份验证（MFA）作为组织策略的一部分进行集成，可以大大降低对手获得有效证书控制权的风险，这些证书可用于其他策略，如初始访问、横向移动和收集信息。MFA还可以用于限制对云资源和API的访问。"
            }
          ]
        ]
      },
      {
        "id": "M1028",
        "name": "操作系统配置",
        "description": [
          [
            {
              "type": "text",
              "content": "确保只注册了有效的密码筛选器。筛选器DLL必须存在于域控制器和/或本地计算机的Windows安装目录（默认情况下为"
            },
            {
              "type": "code",
              "content": "C:\\Windows\\System32\\"
            },
            {
              "type": "text",
              "content": "）中，并在"
            },
            {
              "type": "code",
              "content": "HKEY_local_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Notification Packages"
            },
            {
              "type": "text",
              "content": "中具有相应的条目。"
            }
          ],
          [
            {
              "type": "text",
              "content": "从Windows 11 22H2开始，可以通过组策略或配置服务提供商禁用"
            },
            {
              "type": "code",
              "content": "EnableMPRNotifications"
            },
            {
              "type": "text",
              "content": "策略，以阻止Winlogon向网络提供商发送凭据。"
            }
          ]
        ]
      },
      {
        "id": "M1027",
        "name": "密码策略",
        "description": [
          [
            {
              "type": "text",
              "content": "确保"
            },
            {
              "type": "code",
              "content": "AllowReversiblePasswordEncryption"
            },
            {
              "type": "text",
              "content": "属性设置为禁用，除非有应用程序要求。"
            }
          ]
        ]
      },
      {
        "id": "M1026",
        "name": "特权帐户管理",
        "description": [
          [
            {
              "type": "text",
              "content": "定期审核域和本地帐户及其权限级别，以寻找可能允许对手通过获取特权帐户的凭据获得广泛访问权限的情况。这些审计还应包括是否已启用默认帐户，或者是否创建了未经授权的新本地帐户。遵循企业网络设计和管理的最佳实践，以限制跨管理层的特权帐户使用。"
            }
          ],
          [
            {
              "type": "text",
              "content": "通过适当的权限分离（例如SELinux、grsecurity、AppArmor等）和限制权限提升机会，限制对根帐户的访问，防止用户修改受保护的组件。"
            }
          ],
          [
            {
              "type": "text",
              "content": "限制可访问混合身份解决方案的本地帐户。例如，将Azure AD Global Administrator帐户限制为仅需要的帐户，并确保这些帐户是专用的纯云帐户，而不是混合帐户。"
            }
          ]
        ]
      },
      {
        "id": "M1025",
        "name": "特权流程完整性",
        "description": [
          [
            {
              "type": "text",
              "content": "已启用LSA的功能，如受保护的过程灯（PPL）。"
            }
          ]
        ]
      },
      {
        "id": "M1022",
        "name": "限制文件和目录权限",
        "description": [
          [
            {
              "type": "text",
              "content": "限制对"
            },
            {
              "type": "code",
              "content": "/Library/Security/SecurityAgentPlugins"
            },
            {
              "type": "text",
              "content": "目录的写入访问。"
            }
          ]
        ]
      },
      {
        "id": "M1024",
        "name": "限制注册表权限",
        "description": [
          [
            {
              "type": "text",
              "content": "限制注册表权限以禁止修改敏感注册表项，如"
            },
            {
              "type": "code",
              "content": "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order"
            },
            {
              "type": "text",
              "content": "。"
            }
          ]
        ]
      },
      {
        "id": "M1018",
        "name": "用户帐户管理",
        "description": [
          [
            {
              "type": "text",
              "content": "确保实施适当的策略，以规定用户帐户的身份验证机制（如MFA）的安全注册和停用。"
            }
          ]
        ]
      }
    ]
  }
]
