[
  {
    "id": "T1608",
    "name": "Stage Capabilities",
    "tactics": [
      {
        "id": "TA0042",
        "name": "Resource Development"
      }
    ],
    "subs": [
      {
        "id": "T1608.001",
        "name": "Upload Malware"
      },
      {
        "id": "T1608.002",
        "name": "Upload Tool"
      },
      {
        "id": "T1608.003",
        "name": "Install Digital Certificate"
      },
      {
        "id": "T1608.004",
        "name": "Drive-by Target"
      },
      {
        "id": "T1608.005",
        "name": "Link Target"
      },
      {
        "id": "T1608.006",
        "name": "SEO Poisoning"
      }
    ],
    "version": "1.2",
    "description": [
      [
        {
          "type": "text",
          "content": "敌人可以上传、安装或以其他方式设置可在瞄准过程中使用的功能。为了支持他们的行动，对手可能需要获得他们开发的（发展能力）或获得的（获得能力）能力，并将其部署在他们控制的基础设施上。这些能力可以在对手之前购买/租用的基础设施上进行部署（获取基础设施），或者在其他方面受到对手的损害（损害基础设施）。功能也可以在web服务上部署，如GitHub或Pastebin，或在平台即服务（PaaS）产品上部署，使用户可以轻松地配置应用程序。"
        }
      ],
      [
        {
          "type": "text",
          "content": "能力的分级可以帮助对手进行一些初始访问和妥协后的行为，包括（但不限于）："
        }
      ],
      [
        {
          "type": "list",
          "content": "当用户浏览到某个网站时，暂存执行“按妥协驱动”所需的web资源。"
        },
        {
          "type": "list",
          "content": "正在暂存链接目标的web资源，以便与鱼叉式网络钓鱼一起使用。"
        },
        {
          "type": "list",
          "content": "将恶意软件或工具上传到受害者网络可访问的位置，以启用Ingress Tool Transfer。"
        },
        {
          "type": "list",
          "content": "安装以前获取的SSL/TLS证书以用于加密命令和控制流量（例如：使用Web协议的不对称加密）。"
        }
      ]
    ],
    "mitigations": [
      {
        "id": "M1056",
        "name": "Pre-compromise",
        "description": [
          [
            {
              "type": "text",
              "content": "This technique cannot be easily mitigated with preventive controls since it is based on behaviors performed outside of the scope of enterprise defenses and controls."
            }
          ]
        ]
      }
    ]
  },
  {
    "id": "T1558",
    "name": "Steal or Forge Kerberos Tickets",
    "tactics": [
      {
        "id": "TA0006",
        "name": "Credential Access"
      }
    ],
    "subs": [
      {
        "id": "T1558.001",
        "name": "Golden Ticket"
      },
      {
        "id": "T1558.002",
        "name": "Silver Ticket"
      },
      {
        "id": "T1558.003",
        "name": "Kerberoasting"
      },
      {
        "id": "T1558.004",
        "name": "AS-REP Roasting"
      }
    ],
    "version": "1.4",
    "description": [
      [
        {
          "type": "text",
          "content": "对手可能试图通过窃取或伪造Kerberos票证来破坏Kerberos身份验证，从而启用“通过票证”。Kerberos是一种在现代Windows域环境中广泛使用的身份验证协议。在Kerberos环境（称为“领域”）中，有三个基本参与者：客户端、服务和密钥分发中心（KDC）。客户端请求访问服务，并通过交换源自KDC的Kerberos票证，在成功进行身份验证后授予访问权限。KDC负责身份验证和票证授予。对手可能试图通过窃取票证或伪造票证来滥用Kerberos，以实现未经授权的访问。"
        }
      ],
      [
        {
          "type": "text",
          "content": "在Windows上，内置的"
        },
        {
          "type": "code",
          "content": "klist"
        },
        {
          "type": "text",
          "content": "实用程序可用于列出和分析缓存的Kerberos票证。"
        }
      ],
      [
        {
          "type": "text",
          "content": "Active Directory域上的Linux系统将Kerberos凭据本地存储在称为“ccache”的凭据缓存文件中。凭据存储在ccache文件中，同时它们保持有效，通常在用户会话持续期间。在现代Redhat Enterprise Linux系统和衍生发行版上，系统安全服务守护程序（SSSD）处理Kerberos票证。默认情况下，SSSD维护可在"
        },
        {
          "type": "code",
          "content": "/var/lib/sss/ssecrets/secrets.ldb"
        },
        {
          "type": "text",
          "content": "中找到的票证数据库的副本，以及位于"
        },
        {
          "type": "code",
          "content": "/var/lib/sss/ssecrets/.ssecrets.mkey"
        },
        {
          "type": "text",
          "content": "的相应密钥。这两个文件都需要root访问权限才能读取。如果对手能够访问数据库和密钥，则可以提取凭证缓存Kerberos blob，并将其转换为可用的Kerberos ccache文件，对手可以使用该文件来传递票证。ccache文件也可以使用Kekeo等工具转换为Windows格式。"
        }
      ],
      [
        {
          "type": "text",
          "content": "macOS上的Kerberos票证以类似于Linux的标准ccache格式存储。默认情况下，对这些ccache条目的访问是通过马赫RPC协议通过KCM守护进程进行联合的，该协议使用调用方的环境来确定访问。这些ccache条目的存储位置受"
        },
        {
          "type": "code",
          "content": "/etc/krb5.conf"
        },
        {
          "type": "text",
          "content": "配置文件和"
        },
        {
          "type": "code",
          "content": "KRB5CCNAME"
        },
        {
          "type": "text",
          "content": "环境变量的影响，后者可以指定将它们保存到磁盘或通过KCM守护进程保护它们。用户可以使用"
        },
        {
          "type": "code",
          "content": "kinit"
        },
        {
          "type": "text",
          "content": "、"
        },
        {
          "type": "code",
          "content": "klist"
        },
        {
          "type": "text",
          "content": "，"
        },
        {
          "type": "code",
          "content": "ktutil"
        },
        {
          "type": "text",
          "content": "和"
        },
        {
          "type": "code",
          "content": "kcc"
        },
        {
          "type": "text",
          "content": "内置二进制文件或通过苹果的本地Kerberos框架与票证存储交互。对手可以使用开源工具直接与ccache文件交互，也可以使用Kerberos框架调用较低级别的API来提取用户的TGT或服务票证。"
        }
      ]
    ],
    "mitigations": [
      {
        "id": "M1015",
        "name": "Active Directory Configuration",
        "description": [
          [
            {
              "type": "text",
              "content": "For containing the impact of a previously generated golden ticket, reset the built-in KRBTGT account password twice, which will invalidate any existing golden tickets that have been created with the KRBTGT hash and other Kerberos tickets derived from it. For each domain, change the KRBTGT account password once, force replication, and then change the password a second time. Consider rotating the KRBTGT account password every 180 days."
            }
          ]
        ]
      },
      {
        "id": "M1041",
        "name": "Encrypt Sensitive Information",
        "description": [
          [
            {
              "type": "text",
              "content": "Enable AES Kerberos encryption (or another stronger encryption algorithm), rather than RC4, where possible."
            }
          ]
        ]
      },
      {
        "id": "M1027",
        "name": "Password Policies",
        "description": [
          [
            {
              "type": "text",
              "content": "Ensure strong password length (ideally 25+ characters) and complexity for service accounts and that these passwords periodically expire. Also consider using Group Managed Service Accounts or another third party product such as password vaulting."
            }
          ]
        ]
      },
      {
        "id": "M1026",
        "name": "Privileged Account Management",
        "description": [
          [
            {
              "type": "text",
              "content": "Limit domain admin account permissions to domain controllers and limited servers. Delegate other admin functions to separate accounts."
            }
          ],
          [
            {
              "type": "text",
              "content": "Limit service accounts to minimal required privileges, including membership in privileged groups such as Domain Administrators."
            }
          ]
        ]
      }
    ]
  }
]
